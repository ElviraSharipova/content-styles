{"ast":null,"code":"var _jsxFileName = \"/home/dekor/eqvium/react_material_test/admin-full/src/pages/profile/Profile.js\";\nimport React, { useEffect } from 'react';\nimport { Grid, Box, TextField } from '@material-ui/core';\nimport Tabs from '@material-ui/core/Tabs';\nimport Tab from '@material-ui/core/Tab';\nimport { useParams } from 'react-router';\nimport Checkbox from '@material-ui/core/Checkbox';\nimport Switch from '@material-ui/core/Switch';\nimport { useLocation, useHistory } from 'react-router-dom';\nimport useStyles from './styles';\nimport { PersonOutline as PersonOutlineIcon, Lock as LockIcon, Settings as SettingsIcon } from '@material-ui/icons';\nimport uuid from 'uuid/v4';\nimport Widget from '../../components/Widget';\nimport { Typography, Button } from '../../components/Wrappers';\nimport Select from '@material-ui/core/Select';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\nimport FormControl from '@material-ui/core/FormControl';\nimport { toast } from 'react-toastify';\nimport Notification from '../../components/Notification';\nimport { useManagementDispatch, useManagementState } from '../../context/ManagementContext';\nimport config from '../../config';\nimport Axios from 'axios';\nimport axios from 'axios';\nimport { actions } from '../../context/ManagementContext';\n\nconst Profile = () => {\n  const user_id = localStorage.getItem(\"user\");\n  let data_email;\n  let data_phone;\n  axios.get(\"/profiles/\" + user_id).then(res => {\n    data_email = res.data.email;\n    data_phone = res.data.phone_num;\n  }).catch(err => console.error(err));\n  const classes = useStyles();\n  const [tab, setTab] = React.useState(0);\n  const [password, setPassword] = React.useState({\n    newPassword: '',\n    confirmPassword: '',\n    currentPassword: ''\n  });\n  const [data, setData] = React.useState(null);\n  const [editable, setEditable] = React.useState(false);\n  let {\n    id\n  } = useParams();\n  const fileInput = React.useRef(null);\n\n  const handleChangeTab = (event, newValue) => {\n    setTab(newValue);\n  };\n\n  const location = useLocation();\n  const managementDispatch = useManagementDispatch();\n  const managementValue = useManagementState();\n\n  function extractExtensionFrom(filename) {\n    if (!filename) {\n      return null;\n    }\n\n    const regex = /(?:\\.([^.]+))?$/;\n    return regex.exec(filename)[1];\n  }\n\n  const uploadToServer = async (file, path, filename) => {\n    const formData = new FormData();\n    formData.append('file', file);\n    formData.append('filename', filename);\n    const uri = `${config.baseURLApi}/file/upload/${path}`;\n    await Axios.post(uri, formData, {\n      headers: {\n        'Content-Type': 'multipart/form-data'\n      }\n    });\n    const privateUrl = `${path}/${filename}`;\n    return `${config.baseURLApi}/file/download?privateUrl=${privateUrl}`;\n  };\n\n  const handleFile = async event => {\n    const file = event.target.files[0];\n    const extension = extractExtensionFrom(file.name);\n    const id = uuid();\n    const filename = `${id}.${extension}`;\n    const privateUrl = `users/avatar/${filename}`;\n    const publicUrl = await uploadToServer(file, 'users/avatar', filename);\n    let avatarObj = {\n      id: id,\n      name: file.name,\n      sizeInBytes: file.size,\n      privateUrl,\n      publicUrl,\n      new: true\n    };\n    setData({ ...data,\n      avatar: [...data.avatar, avatarObj]\n    });\n    return null;\n  };\n\n  const history = useHistory();\n\n  function sendNotification() {\n    const componentProps = {\n      type: \"feedback\",\n      message: \"User edited!\",\n      variant: \"contained\",\n      color: \"success\"\n    };\n    const options = {\n      type: \"info\",\n      position: toast.POSITION.TOP_RIGHT,\n      progressClassName: classes.progress,\n      className: classes.notification,\n      timeOut: 1000\n    };\n    return toast( /*#__PURE__*/React.createElement(Notification, Object.assign({}, componentProps, {\n      className: classes.notificationComponent,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 138,\n        columnNumber: 9\n      }\n    })), options);\n  }\n\n  useEffect(() => {\n    if (id !== 'edit') {\n      actions.doFind(id)(managementDispatch);\n    } else {\n      actions.doFind(sessionStorage.getItem('user_id'))(managementDispatch);\n    }\n  }, []);\n  useEffect(() => {\n    if (location.pathname.includes('edit')) {\n      setEditable(true);\n    }\n  }, [location.pathname]);\n  useEffect(() => {\n    setData(managementValue.currentUser);\n  }, [managementDispatch, managementValue, id]);\n\n  const deleteOneImage = id => {\n    setData({ ...data,\n      avatar: data.avatar.filter(avatar => avatar.id !== id)\n    });\n  };\n\n  function handleSubmit() {\n    if (id === 'edit') {\n      actions.doUpdate(sessionStorage.getItem('user_id'), data, history)(managementDispatch);\n    } else {\n      actions.doUpdate(id, data, history)(managementDispatch);\n    }\n\n    sendNotification();\n  }\n\n  function handleUpdatePassword() {\n    actions.doChangePassword(password)(managementDispatch);\n  }\n\n  function handleChangePassword(e) {\n    setPassword({ ...password,\n      [e.target.name]: e.target.value\n    });\n  }\n\n  function handleChange(e) {\n    setData({ ...data,\n      [e.target.name]: e.target.value\n    });\n  }\n\n  return /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    spacing: 3,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 200,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 201,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Widget, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Box, {\n    display: 'flex',\n    justifyContent: 'center',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(Tabs, {\n    indicatorColor: \"primary\",\n    textColor: \"primary\",\n    value: tab,\n    onChange: handleChangeTab,\n    \"aria-label\": \"full width tabs example\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 204,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(Tab, {\n    label: \"\\u041F\\u0440\\u043E\\u0444\\u0438\\u043B\\u044C\",\n    icon: /*#__PURE__*/React.createElement(PersonOutlineIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 213,\n        columnNumber: 39\n      }\n    }),\n    classes: {\n      wrapper: classes.icon\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211,\n      columnNumber: 29\n    }\n  }), /*#__PURE__*/React.createElement(Tab, {\n    label: \"\\u0421\\u043C\\u0435\\u043D\\u0438\\u0442\\u044C \\u043F\\u0430\\u0440\\u043E\\u043B\\u044C\",\n    icon: /*#__PURE__*/React.createElement(LockIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 218,\n        columnNumber: 39\n      }\n    }),\n    classes: {\n      wrapper: classes.icon\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 216,\n      columnNumber: 29\n    }\n  }), /*#__PURE__*/React.createElement(Tab, {\n    label: \"\\u041D\\u0430\\u0441\\u0442\\u0440\\u043E\\u0439\\u043A\\u0438\",\n    icon: /*#__PURE__*/React.createElement(SettingsIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 223,\n        columnNumber: 39\n      }\n    }),\n    classes: {\n      wrapper: classes.icon\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 221,\n      columnNumber: 29\n    }\n  }))))), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 230,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Widget, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 231,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    justify: 'center',\n    container: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 232,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(Box, {\n    display: 'flex',\n    flexDirection: 'column',\n    width: 600,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 233,\n      columnNumber: 25\n    }\n  }, tab === 0 ? /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Typography, {\n    variant: 'h5',\n    weight: 'medium',\n    style: {\n      marginBottom: 35\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 240,\n      columnNumber: 37\n    }\n  }, \"\\u041B\\u0438\\u0447\\u043D\\u044B\\u0435 \\u0434\\u0430\\u043D\\u043D\\u044B\\u0435\"), /*#__PURE__*/React.createElement(Typography, {\n    weight: 'medium',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 247,\n      columnNumber: 37\n    }\n  }, \"\\u0410\\u0432\\u0430\\u0442\\u0430\\u0440:\"), /*#__PURE__*/React.createElement(\"div\", {\n    class: classes.galleryWrap,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 250,\n      columnNumber: 37\n    }\n  }, data && data.avatar && data.avatar.length !== 0 ? data.avatar.map((avatar, idx) => /*#__PURE__*/React.createElement(\"div\", {\n    className: classes.imgWrap,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 253,\n      columnNumber: 41\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    className: classes.deleteImageX,\n    onClick: () => deleteOneImage(avatar.id),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 254,\n      columnNumber: 43\n    }\n  }, \"\\xD7\"), /*#__PURE__*/React.createElement(\"img\", {\n    src: avatar.publicUrl,\n    alt: \"photo\",\n    height: '100%',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 255,\n      columnNumber: 43\n    }\n  }))) : null), /*#__PURE__*/React.createElement(\"label\", {\n    className: classes.uploadLabel,\n    style: {\n      cursor: 'pointer'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 264,\n      columnNumber: 37\n    }\n  }, 'Загрузить фото', /*#__PURE__*/React.createElement(\"input\", {\n    style: {\n      display: 'none'\n    },\n    accept: \"image/*\",\n    type: \"file\",\n    ref: fileInput,\n    onChange: handleFile,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 269,\n      columnNumber: 41\n    }\n  })), /*#__PURE__*/React.createElement(Typography, {\n    size: 'sm',\n    style: {\n      marginBottom: 35\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 272,\n      columnNumber: 37\n    }\n  }, \".PNG, .JPG, .JPEG\"), /*#__PURE__*/React.createElement(TextField, {\n    id: \"outlined-basic\",\n    variant: \"outlined\",\n    style: {\n      marginBottom: 35\n    },\n    defaultValue: data_phone,\n    value: data_phone,\n    name: \"phone\",\n    onChange: handleChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 278,\n      columnNumber: 37\n    }\n  }), /*#__PURE__*/React.createElement(TextField, {\n    id: \"outlined-basic\",\n    variant: \"outlined\",\n    style: {\n      marginBottom: 35\n    },\n    type: 'email',\n    defaultValue: data_email,\n    value: data_email,\n    name: \"email\",\n    onChange: handleChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 287,\n      columnNumber: 37\n    }\n  })) : tab === 1 ? /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Typography, {\n    variant: 'h5',\n    weight: 'medium',\n    style: {\n      marginBottom: 35\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 300,\n      columnNumber: 37\n    }\n  }, \"\\u041F\\u0430\\u0440\\u043E\\u043B\\u044C\"), /*#__PURE__*/React.createElement(TextField, {\n    id: \"outlined-basic\",\n    variant: \"outlined\",\n    style: {\n      marginBottom: 35\n    },\n    defaultValue: 'Current Password',\n    value: password.currentPassword || '',\n    name: \"currentPassword\",\n    onChange: handleChangePassword,\n    helperText: 'Забыли пароль?',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 307,\n      columnNumber: 37\n    }\n  }), /*#__PURE__*/React.createElement(TextField, {\n    id: \"outlined-basic\",\n    variant: \"outlined\",\n    style: {\n      marginBottom: 35\n    },\n    defaultValue: 'New Password',\n    value: password.newPassword || '',\n    name: \"newPassword\",\n    onChange: handleChangePassword,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 317,\n      columnNumber: 37\n    }\n  }), /*#__PURE__*/React.createElement(TextField, {\n    id: \"outlined-basic\",\n    variant: \"outlined\",\n    style: {\n      marginBottom: 35\n    },\n    defaultValue: 'Verify Password',\n    value: password.confirmPassword || '',\n    name: \"confirmPassword\",\n    onChange: handleChangePassword,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 326,\n      columnNumber: 37\n    }\n  })) : /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Typography, {\n    variant: 'h5',\n    weight: 'medium',\n    style: {\n      marginBottom: 35\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 338,\n      columnNumber: 37\n    }\n  }, \"\\u041D\\u0430\\u0441\\u0442\\u0440\\u043E\\u0439\\u043A\\u0438\"), /*#__PURE__*/React.createElement(FormControl, {\n    variant: \"outlined\",\n    style: {\n      marginBottom: 35\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 345,\n      columnNumber: 37\n    }\n  }, /*#__PURE__*/React.createElement(Select, {\n    labelId: \"demo-simple-select-outlined-label\",\n    id: \"demo-simple-select-outlined\",\n    value: 10,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 349,\n      columnNumber: 41\n    }\n  }, /*#__PURE__*/React.createElement(MenuItem, {\n    value: 10,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 354,\n      columnNumber: 45\n    }\n  }, \"\\u042F\\u0437\\u044B\\u043A - \\u0420\\u0443\\u0441\\u0441\\u043A\\u0438\\u0439\"), /*#__PURE__*/React.createElement(MenuItem, {\n    value: 20,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 357,\n      columnNumber: 45\n    }\n  }), /*#__PURE__*/React.createElement(MenuItem, {\n    value: 30,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 359,\n      columnNumber: 45\n    }\n  }))), /*#__PURE__*/React.createElement(Box, {\n    display: \"flex\",\n    mt: 2,\n    alignItems: \"center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 363,\n      columnNumber: 37\n    }\n  }, /*#__PURE__*/React.createElement(Typography, {\n    weight: \"medium\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 364,\n      columnNumber: 41\n    }\n  }, \"\\u0423\\u0432\\u0435\\u0434\\u043E\\u043C\\u043B\\u0435\\u043D\\u0438\\u044F \\u043F\\u043E email\"), /*#__PURE__*/React.createElement(Switch, {\n    color: \"primary\",\n    checked: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 367,\n      columnNumber: 41\n    }\n  }))), editable && /*#__PURE__*/React.createElement(Box, {\n    display: 'flex',\n    justifyContent: 'space-between',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 372,\n      columnNumber: 31\n    }\n  }, tab !== 2 ? /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Button, {\n    variant: 'outlined',\n    color: 'primary',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 378,\n      columnNumber: 35\n    }\n  }, \"Reset\"), /*#__PURE__*/React.createElement(Button, {\n    variant: 'contained',\n    color: 'success',\n    onClick: handleSubmit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 381,\n      columnNumber: 35\n    }\n  }, \"Save\")) : /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Button, {\n    variant: 'outlined',\n    color: 'primary',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 387,\n      columnNumber: 35\n    }\n  }, \"Reset\"), /*#__PURE__*/React.createElement(Button, {\n    variant: 'contained',\n    color: 'success',\n    onClick: handleUpdatePassword,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 390,\n      columnNumber: 35\n    }\n  }, \"Save Password\"))))))));\n};\n\nexport default Profile;","map":{"version":3,"sources":["/home/dekor/eqvium/react_material_test/admin-full/src/pages/profile/Profile.js"],"names":["React","useEffect","Grid","Box","TextField","Tabs","Tab","useParams","Checkbox","Switch","useLocation","useHistory","useStyles","PersonOutline","PersonOutlineIcon","Lock","LockIcon","Settings","SettingsIcon","uuid","Widget","Typography","Button","Select","MenuItem","FormControlLabel","FormControl","toast","Notification","useManagementDispatch","useManagementState","config","Axios","axios","actions","Profile","user_id","localStorage","getItem","data_email","data_phone","get","then","res","data","email","phone_num","catch","err","console","error","classes","tab","setTab","useState","password","setPassword","newPassword","confirmPassword","currentPassword","setData","editable","setEditable","id","fileInput","useRef","handleChangeTab","event","newValue","location","managementDispatch","managementValue","extractExtensionFrom","filename","regex","exec","uploadToServer","file","path","formData","FormData","append","uri","baseURLApi","post","headers","privateUrl","handleFile","target","files","extension","name","publicUrl","avatarObj","sizeInBytes","size","new","avatar","history","sendNotification","componentProps","type","message","variant","color","options","position","POSITION","TOP_RIGHT","progressClassName","progress","className","notification","timeOut","notificationComponent","doFind","sessionStorage","pathname","includes","currentUser","deleteOneImage","filter","handleSubmit","doUpdate","handleUpdatePassword","doChangePassword","handleChangePassword","e","value","handleChange","wrapper","icon","marginBottom","galleryWrap","length","map","idx","imgWrap","deleteImageX","uploadLabel","cursor","display"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,SAASC,IAAT,EAAeC,GAAf,EAAoBC,SAApB,QAAqC,mBAArC;AACA,OAAOC,IAAP,MAAiB,wBAAjB;AACA,OAAOC,GAAP,MAAgB,uBAAhB;AACA,SAASC,SAAT,QAA0B,cAA1B;AACA,OAAOC,QAAP,MAAqB,4BAArB;AACA,OAAOC,MAAP,MAAmB,0BAAnB;AACA,SAASC,WAAT,EAAsBC,UAAtB,QAAwC,kBAAxC;AACA,OAAOC,SAAP,MAAsB,UAAtB;AAEA,SACIC,aAAa,IAAIC,iBADrB,EAEIC,IAAI,IAAIC,QAFZ,EAGIC,QAAQ,IAAIC,YAHhB,QAIO,oBAJP;AAKA,OAAOC,IAAP,MAAiB,SAAjB;AAEA,OAAOC,MAAP,MAAmB,yBAAnB;AACA,SAASC,UAAT,EAAqBC,MAArB,QAAmC,2BAAnC;AACA,OAAOC,MAAP,MAAmB,0BAAnB;AACA,OAAOC,QAAP,MAAqB,4BAArB;AACA,OAAOC,gBAAP,MAA6B,oCAA7B;AACA,OAAOC,WAAP,MAAwB,+BAAxB;AACA,SAASC,KAAT,QAAsB,gBAAtB;AAEA,OAAOC,YAAP,MAAyB,+BAAzB;AACA,SACEC,qBADF,EAEEC,kBAFF,QAGO,iCAHP;AAIA,OAAOC,MAAP,MAAmB,cAAnB;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,OAAOC,KAAP,MAAkB,OAAlB;AAEA,SAASC,OAAT,QAAwB,iCAAxB;;AAEA,MAAMC,OAAO,GAAG,MAAM;AAGjB,QAAMC,OAAO,GAAGC,YAAY,CAACC,OAAb,CAAqB,MAArB,CAAhB;AACA,MAAIC,UAAJ;AACA,MAAIC,UAAJ;AAEAP,EAAAA,KAAK,CAACQ,GAAN,CAAU,eAAaL,OAAvB,EAAgCM,IAAhC,CAAqCC,GAAG,IAAI;AAAEJ,IAAAA,UAAU,GAAEI,GAAG,CAACC,IAAJ,CAASC,KAArB;AAA4BL,IAAAA,UAAU,GAAIG,GAAG,CAACC,IAAJ,CAASE,SAAvB;AAAkC,GAA5G,EAA8GC,KAA9G,CAAoHC,GAAG,IAAIC,OAAO,CAACC,KAAR,CAAcF,GAAd,CAA3H;AAID,QAAMG,OAAO,GAAGvC,SAAS,EAAzB;AACA,QAAM,CAACwC,GAAD,EAAMC,MAAN,IAAgBrD,KAAK,CAACsD,QAAN,CAAe,CAAf,CAAtB;AACA,QAAM,CAACC,QAAD,EAAWC,WAAX,IAA0BxD,KAAK,CAACsD,QAAN,CAAe;AAC7CG,IAAAA,WAAW,EAAE,EADgC;AAE7CC,IAAAA,eAAe,EAAE,EAF4B;AAG7CC,IAAAA,eAAe,EAAE;AAH4B,GAAf,CAAhC;AAKA,QAAM,CAACf,IAAD,EAAOgB,OAAP,IAAkB5D,KAAK,CAACsD,QAAN,CAAe,IAAf,CAAxB;AACA,QAAM,CAACO,QAAD,EAAWC,WAAX,IAA0B9D,KAAK,CAACsD,QAAN,CAAe,KAAf,CAAhC;AACA,MAAI;AAAES,IAAAA;AAAF,MAASxD,SAAS,EAAtB;AACA,QAAMyD,SAAS,GAAGhE,KAAK,CAACiE,MAAN,CAAa,IAAb,CAAlB;;AACA,QAAMC,eAAe,GAAG,CAACC,KAAD,EAAQC,QAAR,KAAqB;AACzCf,IAAAA,MAAM,CAACe,QAAD,CAAN;AACH,GAFD;;AAGA,QAAMC,QAAQ,GAAG3D,WAAW,EAA5B;AACA,QAAM4D,kBAAkB,GAAGzC,qBAAqB,EAAhD;AACA,QAAM0C,eAAe,GAAGzC,kBAAkB,EAA1C;;AAEA,WAAS0C,oBAAT,CAA8BC,QAA9B,EAAwC;AACtC,QAAI,CAACA,QAAL,EAAe;AACb,aAAO,IAAP;AACD;;AAED,UAAMC,KAAK,GAAG,iBAAd;AACA,WAAOA,KAAK,CAACC,IAAN,CAAWF,QAAX,EAAqB,CAArB,CAAP;AACD;;AAED,QAAMG,cAAc,GAAG,OAAOC,IAAP,EAAaC,IAAb,EAAmBL,QAAnB,KAAgC;AACrD,UAAMM,QAAQ,GAAG,IAAIC,QAAJ,EAAjB;AACAD,IAAAA,QAAQ,CAACE,MAAT,CAAgB,MAAhB,EAAwBJ,IAAxB;AACAE,IAAAA,QAAQ,CAACE,MAAT,CAAgB,UAAhB,EAA4BR,QAA5B;AACA,UAAMS,GAAG,GAAI,GAAEnD,MAAM,CAACoD,UAAW,gBAAeL,IAAK,EAArD;AACA,UAAM9C,KAAK,CAACoD,IAAN,CAAWF,GAAX,EAAgBH,QAAhB,EACJ;AACEM,MAAAA,OAAO,EAAE;AACP,wBAAgB;AADT;AADX,KADI,CAAN;AAQA,UAAMC,UAAU,GAAI,GAAER,IAAK,IAAGL,QAAS,EAAvC;AAEA,WAAQ,GAAE1C,MAAM,CAACoD,UAAW,6BAA4BG,UAAW,EAAnE;AACD,GAhBD;;AAkBA,QAAMC,UAAU,GAAG,MAAOpB,KAAP,IAAiB;AAClC,UAAMU,IAAI,GAAGV,KAAK,CAACqB,MAAN,CAAaC,KAAb,CAAmB,CAAnB,CAAb;AAEA,UAAMC,SAAS,GAAGlB,oBAAoB,CAACK,IAAI,CAACc,IAAN,CAAtC;AACA,UAAM5B,EAAE,GAAG5C,IAAI,EAAf;AACA,UAAMsD,QAAQ,GAAI,GAAEV,EAAG,IAAG2B,SAAU,EAApC;AACA,UAAMJ,UAAU,GAAI,gBAAeb,QAAS,EAA5C;AAEA,UAAMmB,SAAS,GAAG,MAAMhB,cAAc,CACpCC,IADoC,EAEpC,cAFoC,EAGpCJ,QAHoC,CAAtC;AAKA,QAAIoB,SAAS,GAAG;AACd9B,MAAAA,EAAE,EAAEA,EADU;AAEd4B,MAAAA,IAAI,EAAEd,IAAI,CAACc,IAFG;AAGdG,MAAAA,WAAW,EAAEjB,IAAI,CAACkB,IAHJ;AAIdT,MAAAA,UAJc;AAKdM,MAAAA,SALc;AAMdI,MAAAA,GAAG,EAAE;AANS,KAAhB;AASApC,IAAAA,OAAO,CAAC,EACN,GAAGhB,IADG;AAENqD,MAAAA,MAAM,EAAE,CAAC,GAAGrD,IAAI,CAACqD,MAAT,EAAiBJ,SAAjB;AAFF,KAAD,CAAP;AAKA,WAAO,IAAP;AACD,GA5BD;;AA6BA,QAAMK,OAAO,GAAGvF,UAAU,EAA1B;;AACA,WAASwF,gBAAT,GAA4B;AAC1B,UAAMC,cAAc,GAAG;AACrBC,MAAAA,IAAI,EAAE,UADe;AAErBC,MAAAA,OAAO,EAAE,cAFY;AAGrBC,MAAAA,OAAO,EAAE,WAHY;AAIrBC,MAAAA,KAAK,EAAE;AAJc,KAAvB;AAMA,UAAMC,OAAO,GAAG;AACdJ,MAAAA,IAAI,EAAE,MADQ;AAEdK,MAAAA,QAAQ,EAAE/E,KAAK,CAACgF,QAAN,CAAeC,SAFX;AAGdC,MAAAA,iBAAiB,EAAE1D,OAAO,CAAC2D,QAHb;AAIdC,MAAAA,SAAS,EAAE5D,OAAO,CAAC6D,YAJL;AAKdC,MAAAA,OAAO,EAAE;AALK,KAAhB;AAOA,WAAOtF,KAAK,eACV,oBAAC,YAAD,oBACMyE,cADN;AAEE,MAAA,SAAS,EAAEjD,OAAO,CAAC+D,qBAFrB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OADU,EAKVT,OALU,CAAZ;AAOD;;AACDxG,EAAAA,SAAS,CAAC,MAAM;AACd,QAAI8D,EAAE,KAAK,MAAX,EAAmB;AACjB7B,MAAAA,OAAO,CAACiF,MAAR,CAAepD,EAAf,EAAmBO,kBAAnB;AACD,KAFD,MAEO;AACLpC,MAAAA,OAAO,CAACiF,MAAR,CAAeC,cAAc,CAAC9E,OAAf,CAAuB,SAAvB,CAAf,EAAkDgC,kBAAlD;AACD;AACF,GANQ,EAMN,EANM,CAAT;AAQArE,EAAAA,SAAS,CAAC,MAAM;AAEd,QAAIoE,QAAQ,CAACgD,QAAT,CAAkBC,QAAlB,CAA2B,MAA3B,CAAJ,EAAwC;AACtCxD,MAAAA,WAAW,CAAC,IAAD,CAAX;AACD;AACF,GALQ,EAKN,CAACO,QAAQ,CAACgD,QAAV,CALM,CAAT;AAQApH,EAAAA,SAAS,CAAC,MAAM;AACZ2D,IAAAA,OAAO,CAACW,eAAe,CAACgD,WAAjB,CAAP;AACH,GAFQ,EAEN,CAACjD,kBAAD,EAAqBC,eAArB,EAAsCR,EAAtC,CAFM,CAAT;;AAIA,QAAMyD,cAAc,GAAIzD,EAAD,IAAQ;AAC7BH,IAAAA,OAAO,CAAC,EACN,GAAGhB,IADG;AAENqD,MAAAA,MAAM,EAAErD,IAAI,CAACqD,MAAL,CAAYwB,MAAZ,CAAmBxB,MAAM,IAAIA,MAAM,CAAClC,EAAP,KAAcA,EAA3C;AAFF,KAAD,CAAP;AAID,GALD;;AAOA,WAAS2D,YAAT,GAAwB;AACtB,QAAI3D,EAAE,KAAK,MAAX,EAAmB;AACjB7B,MAAAA,OAAO,CAACyF,QAAR,CAAiBP,cAAc,CAAC9E,OAAf,CAAuB,SAAvB,CAAjB,EAAoDM,IAApD,EAA0DsD,OAA1D,EAAmE5B,kBAAnE;AACD,KAFD,MAEO;AACLpC,MAAAA,OAAO,CAACyF,QAAR,CAAiB5D,EAAjB,EAAqBnB,IAArB,EAA2BsD,OAA3B,EAAoC5B,kBAApC;AACD;;AACD6B,IAAAA,gBAAgB;AACjB;;AAED,WAASyB,oBAAT,GAAgC;AAC9B1F,IAAAA,OAAO,CAAC2F,gBAAR,CAAyBtE,QAAzB,EAAmCe,kBAAnC;AACD;;AAED,WAASwD,oBAAT,CAA8BC,CAA9B,EAAiC;AAC/BvE,IAAAA,WAAW,CAAC,EACV,GAAGD,QADO;AAEV,OAACwE,CAAC,CAACvC,MAAF,CAASG,IAAV,GAAiBoC,CAAC,CAACvC,MAAF,CAASwC;AAFhB,KAAD,CAAX;AAID;;AAED,WAASC,YAAT,CAAsBF,CAAtB,EAAyB;AACvBnE,IAAAA,OAAO,CAAC,EACN,GAAGhB,IADG;AAEN,OAACmF,CAAC,CAACvC,MAAF,CAASG,IAAV,GAAiBoC,CAAC,CAACvC,MAAF,CAASwC;AAFpB,KAAD,CAAP;AAID;;AAED,sBACI,oBAAC,IAAD;AAAM,IAAA,SAAS,MAAf;AAAgB,IAAA,OAAO,EAAE,CAAzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACI,oBAAC,IAAD;AAAM,IAAA,IAAI,MAAV;AAAW,IAAA,EAAE,EAAE,EAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACI,oBAAC,MAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACI,oBAAC,GAAD;AAAK,IAAA,OAAO,EAAE,MAAd;AAAsB,IAAA,cAAc,EAAE,QAAtC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACI,oBAAC,IAAD;AACI,IAAA,cAAc,EAAC,SADnB;AAEI,IAAA,SAAS,EAAC,SAFd;AAGI,IAAA,KAAK,EAAE5E,GAHX;AAII,IAAA,QAAQ,EAAEc,eAJd;AAKI,kBAAW,yBALf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAOI,oBAAC,GAAD;AACI,IAAA,KAAK,EAAC,4CADV;AAEI,IAAA,IAAI,eAAE,oBAAC,iBAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAFV;AAGI,IAAA,OAAO,EAAE;AAAEgE,MAAAA,OAAO,EAAE/E,OAAO,CAACgF;AAAnB,KAHb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAPJ,eAYI,oBAAC,GAAD;AACI,IAAA,KAAK,EAAC,iFADV;AAEI,IAAA,IAAI,eAAE,oBAAC,QAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAFV;AAGI,IAAA,OAAO,EAAE;AAAED,MAAAA,OAAO,EAAE/E,OAAO,CAACgF;AAAnB,KAHb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAZJ,eAiBI,oBAAC,GAAD;AACI,IAAA,KAAK,EAAC,wDADV;AAEI,IAAA,IAAI,eAAE,oBAAC,YAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAFV;AAGI,IAAA,OAAO,EAAE;AAAED,MAAAA,OAAO,EAAE/E,OAAO,CAACgF;AAAnB,KAHb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAjBJ,CADJ,CADJ,CADJ,CADJ,eA8BI,oBAAC,IAAD;AAAM,IAAA,IAAI,MAAV;AAAW,IAAA,EAAE,EAAE,EAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACI,oBAAC,MAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACI,oBAAC,IAAD;AAAM,IAAA,IAAI,MAAV;AAAW,IAAA,OAAO,EAAE,QAApB;AAA8B,IAAA,SAAS,MAAvC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACI,oBAAC,GAAD;AACI,IAAA,OAAO,EAAE,MADb;AAEI,IAAA,aAAa,EAAE,QAFnB;AAGI,IAAA,KAAK,EAAE,GAHX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAKM/E,GAAG,KAAK,CAAR,gBACE,uDACI,oBAAC,UAAD;AACI,IAAA,OAAO,EAAE,IADb;AAEI,IAAA,MAAM,EAAE,QAFZ;AAGI,IAAA,KAAK,EAAE;AAAEgF,MAAAA,YAAY,EAAE;AAAhB,KAHX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iFADJ,eAQI,oBAAC,UAAD;AAAY,IAAA,MAAM,EAAE,QAApB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6CARJ,eAWI;AAAK,IAAA,KAAK,EAAEjF,OAAO,CAACkF,WAApB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACCzF,IAAI,IAAIA,IAAI,CAACqD,MAAb,IAAuBrD,IAAI,CAACqD,MAAL,CAAYqC,MAAZ,KAAuB,CAA9C,GACC1F,IAAI,CAACqD,MAAL,CAAYsC,GAAZ,CAAgB,CAACtC,MAAD,EAASuC,GAAT,kBACd;AAAK,IAAA,SAAS,EAAErF,OAAO,CAACsF,OAAxB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE;AAAM,IAAA,SAAS,EAAEtF,OAAO,CAACuF,YAAzB;AAAuC,IAAA,OAAO,EAAE,MAAMlB,cAAc,CAACvB,MAAM,CAAClC,EAAR,CAApE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YADF,eAEE;AACI,IAAA,GAAG,EAAEkC,MAAM,CAACL,SADhB;AAEI,IAAA,GAAG,EAAC,OAFR;AAGI,IAAA,MAAM,EAAE,MAHZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAFF,CADF,CADD,GAWE,IAZH,CAXJ,eAyBI;AACE,IAAA,SAAS,EAAEzC,OAAO,CAACwF,WADrB;AAEE,IAAA,KAAK,EAAE;AAAEC,MAAAA,MAAM,EAAE;AAAV,KAFT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAIG,gBAJH,eAKI;AAAO,IAAA,KAAK,EAAE;AAAEC,MAAAA,OAAO,EAAE;AAAX,KAAd;AAAmC,IAAA,MAAM,EAAC,SAA1C;AAAoD,IAAA,IAAI,EAAC,MAAzD;AAAgE,IAAA,GAAG,EAAE7E,SAArE;AAAgF,IAAA,QAAQ,EAAEuB,UAA1F;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IALJ,CAzBJ,eAiCI,oBAAC,UAAD;AACI,IAAA,IAAI,EAAE,IADV;AAEI,IAAA,KAAK,EAAE;AAAE6C,MAAAA,YAAY,EAAE;AAAhB,KAFX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBAjCJ,eAuCI,oBAAC,SAAD;AACI,IAAA,EAAE,EAAC,gBADP;AAEI,IAAA,OAAO,EAAC,UAFZ;AAGI,IAAA,KAAK,EAAE;AAAEA,MAAAA,YAAY,EAAE;AAAhB,KAHX;AAII,IAAA,YAAY,EAAE5F,UAJlB;AAKI,IAAA,KAAK,EAAEA,UALX;AAMI,IAAA,IAAI,EAAC,OANT;AAOI,IAAA,QAAQ,EAAEyF,YAPd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAvCJ,eAgDI,oBAAC,SAAD;AACI,IAAA,EAAE,EAAC,gBADP;AAEI,IAAA,OAAO,EAAC,UAFZ;AAGI,IAAA,KAAK,EAAE;AAAEG,MAAAA,YAAY,EAAE;AAAhB,KAHX;AAII,IAAA,IAAI,EAAE,OAJV;AAKI,IAAA,YAAY,EAAE7F,UALlB;AAMI,IAAA,KAAK,EAAEA,UANX;AAOI,IAAA,IAAI,EAAC,OAPT;AAQI,IAAA,QAAQ,EAAE0F,YARd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAhDJ,CADF,GA4DE7E,GAAG,KAAK,CAAR,gBACA,uDACI,oBAAC,UAAD;AACI,IAAA,OAAO,EAAE,IADb;AAEI,IAAA,MAAM,EAAE,QAFZ;AAGI,IAAA,KAAK,EAAE;AAAEgF,MAAAA,YAAY,EAAE;AAAhB,KAHX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4CADJ,eAQI,oBAAC,SAAD;AACI,IAAA,EAAE,EAAC,gBADP;AAEI,IAAA,OAAO,EAAC,UAFZ;AAGI,IAAA,KAAK,EAAE;AAAEA,MAAAA,YAAY,EAAE;AAAhB,KAHX;AAII,IAAA,YAAY,EAAE,kBAJlB;AAKI,IAAA,KAAK,EAAE7E,QAAQ,CAACI,eAAT,IAA4B,EALvC;AAMI,IAAA,IAAI,EAAC,iBANT;AAOI,IAAA,QAAQ,EAAEmE,oBAPd;AAQI,IAAA,UAAU,EAAE,gBARhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IARJ,eAkBI,oBAAC,SAAD;AACI,IAAA,EAAE,EAAC,gBADP;AAEI,IAAA,OAAO,EAAC,UAFZ;AAGI,IAAA,KAAK,EAAE;AAAEM,MAAAA,YAAY,EAAE;AAAhB,KAHX;AAII,IAAA,YAAY,EAAE,cAJlB;AAKI,IAAA,KAAK,EAAE7E,QAAQ,CAACE,WAAT,IAAwB,EALnC;AAMI,IAAA,IAAI,EAAC,aANT;AAOI,IAAA,QAAQ,EAAEqE,oBAPd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAlBJ,eA2BI,oBAAC,SAAD;AACI,IAAA,EAAE,EAAC,gBADP;AAEI,IAAA,OAAO,EAAC,UAFZ;AAGI,IAAA,KAAK,EAAE;AAAEM,MAAAA,YAAY,EAAE;AAAhB,KAHX;AAII,IAAA,YAAY,EAAE,iBAJlB;AAKI,IAAA,KAAK,EAAE7E,QAAQ,CAACG,eAAT,IAA4B,EALvC;AAMI,IAAA,IAAI,EAAC,iBANT;AAOI,IAAA,QAAQ,EAAEoE,oBAPd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IA3BJ,CADA,gBAuCA,uDACI,oBAAC,UAAD;AACI,IAAA,OAAO,EAAE,IADb;AAEI,IAAA,MAAM,EAAE,QAFZ;AAGI,IAAA,KAAK,EAAE;AAAEM,MAAAA,YAAY,EAAE;AAAhB,KAHX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,8DADJ,eAQI,oBAAC,WAAD;AACI,IAAA,OAAO,EAAC,UADZ;AAEI,IAAA,KAAK,EAAE;AAAEA,MAAAA,YAAY,EAAE;AAAhB,KAFX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAII,oBAAC,MAAD;AACI,IAAA,OAAO,EAAC,mCADZ;AAEI,IAAA,EAAE,EAAC,6BAFP;AAGI,IAAA,KAAK,EAAE,EAHX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAKI,oBAAC,QAAD;AAAU,IAAA,KAAK,EAAE,EAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6EALJ,eAQI,oBAAC,QAAD;AAAU,IAAA,KAAK,EAAE,EAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IARJ,eAUI,oBAAC,QAAD;AAAU,IAAA,KAAK,EAAE,EAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAVJ,CAJJ,CARJ,eA0BI,oBAAC,GAAD;AAAK,IAAA,OAAO,EAAE,MAAd;AAAsB,IAAA,EAAE,EAAE,CAA1B;AAA6B,IAAA,UAAU,EAAE,QAAzC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACI,oBAAC,UAAD;AAAY,IAAA,MAAM,EAAE,QAApB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6FADJ,eAII,oBAAC,MAAD;AAAQ,IAAA,KAAK,EAAE,SAAf;AAA0B,IAAA,OAAO,MAAjC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAJJ,CA1BJ,CAxGR,EA0IKvE,QAAQ,iBACP,oBAAC,GAAD;AACI,IAAA,OAAO,EAAE,MADb;AAEI,IAAA,cAAc,EAAE,eAFpB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAIGT,GAAG,KAAK,CAAR,gBACC,uDACA,oBAAC,MAAD;AAAQ,IAAA,OAAO,EAAE,UAAjB;AAA6B,IAAA,KAAK,EAAE,SAApC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aADA,eAIA,oBAAC,MAAD;AAAQ,IAAA,OAAO,EAAE,WAAjB;AAA8B,IAAA,KAAK,EAAE,SAArC;AAAgD,IAAA,OAAO,EAAEsE,YAAzD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAJA,CADD,gBAUC,uDACA,oBAAC,MAAD;AAAQ,IAAA,OAAO,EAAE,UAAjB;AAA6B,IAAA,KAAK,EAAE,SAApC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aADA,eAIA,oBAAC,MAAD;AAAQ,IAAA,OAAO,EAAE,WAAjB;AAA8B,IAAA,KAAK,EAAE,SAArC;AAAgD,IAAA,OAAO,EAAEE,oBAAzD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAJA,CAdJ,CA3IN,CADJ,CADJ,CADJ,CA9BJ,CADJ;AA8MH,CAhXD;;AAkXA,eAAezF,OAAf","sourcesContent":["import React, { useEffect } from 'react'\nimport { Grid, Box, TextField } from '@material-ui/core'\nimport Tabs from '@material-ui/core/Tabs'\nimport Tab from '@material-ui/core/Tab'\nimport { useParams } from 'react-router'\nimport Checkbox from '@material-ui/core/Checkbox'\nimport Switch from '@material-ui/core/Switch'\nimport { useLocation, useHistory } from 'react-router-dom';\nimport useStyles from './styles'\n\nimport {\n    PersonOutline as PersonOutlineIcon,\n    Lock as LockIcon,\n    Settings as SettingsIcon,\n} from '@material-ui/icons'\nimport uuid from 'uuid/v4'\n\nimport Widget from '../../components/Widget'\nimport { Typography, Button } from '../../components/Wrappers'\nimport Select from '@material-ui/core/Select'\nimport MenuItem from '@material-ui/core/MenuItem'\nimport FormControlLabel from '@material-ui/core/FormControlLabel'\nimport FormControl from '@material-ui/core/FormControl'\nimport { toast } from 'react-toastify'\n\nimport Notification from '../../components/Notification'\nimport {\n  useManagementDispatch,\n  useManagementState,\n} from '../../context/ManagementContext'\nimport config from '../../config'\nimport Axios from 'axios'\nimport axios from 'axios'\n\nimport { actions } from '../../context/ManagementContext'\n\nconst Profile = () => {\n    \n\n     const user_id = localStorage.getItem(\"user\");\n     let data_email;\n     let data_phone;\n   \n     axios.get(\"/profiles/\"+user_id).then(res => { data_email= res.data.email; data_phone =  res.data.phone_num }).catch(err => console.error(err));\n\n\n\n    const classes = useStyles()\n    const [tab, setTab] = React.useState(0)\n    const [password, setPassword] = React.useState({\n      newPassword: '',\n      confirmPassword: '',\n      currentPassword: '',\n    });\n    const [data, setData] = React.useState(null)\n    const [editable, setEditable] = React.useState(false)\n    let { id } = useParams();\n    const fileInput = React.useRef(null);\n    const handleChangeTab = (event, newValue) => {\n        setTab(newValue)\n    }\n    const location = useLocation();\n    const managementDispatch = useManagementDispatch()\n    const managementValue = useManagementState()\n\n    function extractExtensionFrom(filename) {\n      if (!filename) {\n        return null;\n      }\n    \n      const regex = /(?:\\.([^.]+))?$/;\n      return regex.exec(filename)[1];\n    }\n\n    const uploadToServer = async (file, path, filename) => {\n      const formData = new FormData();\n      formData.append('file', file);\n      formData.append('filename', filename);\n      const uri = `${config.baseURLApi}/file/upload/${path}`;\n      await Axios.post(uri, formData,\n        {\n          headers: {\n            'Content-Type': 'multipart/form-data',\n          },\n        },\n      );\n  \n      const privateUrl = `${path}/${filename}`;\n  \n      return `${config.baseURLApi}/file/download?privateUrl=${privateUrl}`;\n    }\n\n    const handleFile = async (event) => {\n      const file = event.target.files[0];\n  \n      const extension = extractExtensionFrom(file.name);\n      const id = uuid();\n      const filename = `${id}.${extension}`;\n      const privateUrl = `users/avatar/${filename}`;\n  \n      const publicUrl = await uploadToServer(\n        file,\n        'users/avatar',\n        filename,\n      );\n      let avatarObj = {\n        id: id,\n        name: file.name,\n        sizeInBytes: file.size,\n        privateUrl,\n        publicUrl,\n        new: true\n      }\n\n      setData({\n        ...data,\n        avatar: [...data.avatar, avatarObj]\n      })\n\n      return null;\n    }\n    const history = useHistory();\n    function sendNotification() {\n      const componentProps = {\n        type: \"feedback\",\n        message: \"User edited!\",\n        variant: \"contained\",\n        color: \"success\"\n      };\n      const options = {\n        type: \"info\",\n        position: toast.POSITION.TOP_RIGHT,\n        progressClassName: classes.progress,\n        className: classes.notification,\n        timeOut: 1000\n      };\n      return toast(\n        <Notification\n          {...componentProps}\n          className={classes.notificationComponent}\n        />,\n        options\n      );\n    }\n    useEffect(() => {\n      if (id !== 'edit') {\n        actions.doFind(id)(managementDispatch)\n      } else {\n        actions.doFind(sessionStorage.getItem('user_id'))(managementDispatch)\n      }\n    }, []);\n\n    useEffect(() => {\n      \n      if (location.pathname.includes('edit')) {\n        setEditable(true);\n      }\n    }, [location.pathname]);\n\n\n    useEffect(() => {\n        setData(managementValue.currentUser)\n    }, [managementDispatch, managementValue, id])\n\n    const deleteOneImage = (id) => {\n      setData({\n        ...data,\n        avatar: data.avatar.filter(avatar => avatar.id !== id)\n      })\n    }\n\n    function handleSubmit() {\n      if (id === 'edit') {\n        actions.doUpdate(sessionStorage.getItem('user_id'), data, history)(managementDispatch)\n      } else {\n        actions.doUpdate(id, data, history)(managementDispatch)        \n      }\n      sendNotification()\n    }\n\n    function handleUpdatePassword() {\n      actions.doChangePassword(password)(managementDispatch)\n    }\n\n    function handleChangePassword(e) {\n      setPassword({\n        ...password,\n        [e.target.name]: e.target.value,\n      })\n    }\n\n    function handleChange(e) {\n      setData({\n        ...data,\n        [e.target.name]: e.target.value,\n      });\n    }\n\n    return (\n        <Grid container spacing={3}>\n            <Grid item xs={12}>\n                <Widget>\n                    <Box display={'flex'} justifyContent={'center'}>\n                        <Tabs\n                            indicatorColor=\"primary\"\n                            textColor=\"primary\"\n                            value={tab}\n                            onChange={handleChangeTab}\n                            aria-label=\"full width tabs example\"\n                        >\n                            <Tab\n                                label=\"Профиль\"\n                                icon={<PersonOutlineIcon />}\n                                classes={{ wrapper: classes.icon }}\n                            />\n                            <Tab\n                                label=\"Сменить пароль\"\n                                icon={<LockIcon />}\n                                classes={{ wrapper: classes.icon }}\n                            />\n                            <Tab\n                                label=\"Настройки\"\n                                icon={<SettingsIcon />}\n                                classes={{ wrapper: classes.icon }}\n                            />\n                        </Tabs>\n                    </Box>\n                </Widget>\n            </Grid>\n            <Grid item xs={12}>\n                <Widget>\n                    <Grid item justify={'center'} container>\n                        <Box\n                            display={'flex'}\n                            flexDirection={'column'}\n                            width={600}\n                        >\n                            { tab === 0 ? (\n                                <>\n                                    <Typography\n                                        variant={'h5'}\n                                        weight={'medium'}\n                                        style={{ marginBottom: 35 }}\n                                    >\n                                        Личные данные\n                                    </Typography>\n                                    <Typography weight={'medium'}>\n                                        Аватар:\n                                    </Typography>\n                                    <div class={classes.galleryWrap}>\n                                    {data && data.avatar && data.avatar.length !== 0 ? (\n                                      data.avatar.map((avatar, idx) => (\n                                        <div className={classes.imgWrap}>\n                                          <span className={classes.deleteImageX} onClick={() => deleteOneImage(avatar.id)}>×</span>\n                                          <img\n                                              src={avatar.publicUrl}\n                                              alt=\"photo\"\n                                              height={'100%'}\n                                          />                                          \n                                        </div>\n                                      ))\n                                    ): null}\n                                    </div>\n                                    <label\n                                      className={classes.uploadLabel}\n                                      style={{ cursor: 'pointer' }}\n                                    >\n                                      {'Загрузить фото'}\n                                        <input style={{ display: 'none' }} accept=\"image/*\" type=\"file\" ref={fileInput} onChange={handleFile} />\n                                    </label>\n\n                                    <Typography\n                                        size={'sm'}\n                                        style={{ marginBottom: 35 }}\n                                    >\n                                        .PNG, .JPG, .JPEG\n                                    </Typography>\n                                    <TextField\n                                        id=\"outlined-basic\"\n                                        variant=\"outlined\"\n                                        style={{ marginBottom: 35 }}\n                                        defaultValue={data_phone}\n                                        value={data_phone}\n                                        name=\"phone\"\n                                        onChange={handleChange}\n                                    />\n                                    <TextField\n                                        id=\"outlined-basic\"\n                                        variant=\"outlined\"\n                                        style={{ marginBottom: 35 }}\n                                        type={'email'}\n                                        defaultValue={data_email}\n                                        value={data_email}\n                                        name=\"email\"\n                                        onChange={handleChange}\n                                    />\n                                </>\n                            ) : tab === 1 ? (\n                                <>\n                                    <Typography\n                                        variant={'h5'}\n                                        weight={'medium'}\n                                        style={{ marginBottom: 35 }}\n                                    >\n                                        Пароль\n                                    </Typography>\n                                    <TextField\n                                        id=\"outlined-basic\"\n                                        variant=\"outlined\"\n                                        style={{ marginBottom: 35 }}\n                                        defaultValue={'Current Password'}\n                                        value={password.currentPassword || ''}\n                                        name=\"currentPassword\"\n                                        onChange={handleChangePassword}\n                                        helperText={'Забыли пароль?'}\n                                    />\n                                    <TextField\n                                        id=\"outlined-basic\"\n                                        variant=\"outlined\"\n                                        style={{ marginBottom: 35 }}\n                                        defaultValue={'New Password'}\n                                        value={password.newPassword || ''}\n                                        name=\"newPassword\"\n                                        onChange={handleChangePassword}\n                                    />\n                                    <TextField\n                                        id=\"outlined-basic\"\n                                        variant=\"outlined\"\n                                        style={{ marginBottom: 35 }}\n                                        defaultValue={'Verify Password'}\n                                        value={password.confirmPassword || ''}\n                                        name=\"confirmPassword\"\n                                        onChange={handleChangePassword}\n                                    />\n                                </>\n                            ) : (\n                                <>\n                                    <Typography\n                                        variant={'h5'}\n                                        weight={'medium'}\n                                        style={{ marginBottom: 35 }}\n                                    >\n                                        Настройки\n                                    </Typography>\n                                    <FormControl\n                                        variant=\"outlined\"\n                                        style={{ marginBottom: 35 }}\n                                    >\n                                        <Select\n                                            labelId=\"demo-simple-select-outlined-label\"\n                                            id=\"demo-simple-select-outlined\"\n                                            value={10}\n                                        >\n                                            <MenuItem value={10}>\n                                                Язык - Русский\n                                            </MenuItem>\n                                            <MenuItem value={20}>\n                                            </MenuItem>\n                                            <MenuItem value={30}>\n                                            </MenuItem>\n                                        </Select>\n                                    </FormControl>\n                                    <Box display={\"flex\"} mt={2} alignItems={\"center\"}>\n                                        <Typography weight={\"medium\"}>\n                                            Уведомления по email\n                                        </Typography>\n                                        <Switch color={\"primary\"} checked />\n                                    </Box>\n                                </>\n                            )}\n                            {editable && \n                              <Box\n                                  display={'flex'}\n                                  justifyContent={'space-between'}\n                              >\n                                {tab !== 2 ? (\n                                  <>\n                                  <Button variant={'outlined'} color={'primary'}>\n                                      Reset\n                                  </Button>\n                                  <Button variant={'contained'} color={'success'} onClick={handleSubmit}>\n                                      Save\n                                  </Button>\n                                  </>                                \n                                ) : (\n                                  <>\n                                  <Button variant={'outlined'} color={'primary'}>\n                                      Reset\n                                  </Button>\n                                  <Button variant={'contained'} color={'success'} onClick={handleUpdatePassword}>\n                                      Save Password\n                                  </Button>\n                                  </> \n                                )}\n\n                              </Box>                              \n                             \n                            }\n                        </Box>\n                    </Grid>\n                </Widget>\n            </Grid>\n        </Grid>\n    )\n}\n\nexport default Profile\n"]},"metadata":{},"sourceType":"module"}