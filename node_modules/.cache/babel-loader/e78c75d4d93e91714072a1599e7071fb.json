{"ast":null,"code":"var _jsxFileName = \"/home/dekor/eqvium/react_material_test/admin-full/src/pages/profile/Profile.js\";\nimport React, { useEffect } from 'react';\nimport { Grid, Box, TextField } from '@material-ui/core';\nimport Tabs from '@material-ui/core/Tabs';\nimport Tab from '@material-ui/core/Tab';\nimport { useParams } from 'react-router';\nimport Checkbox from '@material-ui/core/Checkbox';\nimport Switch from '@material-ui/core/Switch';\nimport { useLocation, useHistory } from 'react-router-dom';\nimport useStyles from './styles';\nimport { PersonOutline as PersonOutlineIcon, Lock as LockIcon, Settings as SettingsIcon } from '@material-ui/icons';\nimport uuid from 'uuid/v4';\nimport Widget from '../../components/Widget';\nimport { Typography, Button } from '../../components/Wrappers';\nimport Select from '@material-ui/core/Select';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\nimport FormControl from '@material-ui/core/FormControl';\nimport { toast } from 'react-toastify';\nimport Notification from '../../components/Notification';\nimport { useManagementDispatch, useManagementState } from '../../context/ManagementContext';\nimport config from '../../config';\nimport Axios from 'axios';\nimport axios from 'axios';\nimport { actions } from '../../context/ManagementContext';\n\nconst Profile = () => {\n  //     const user_id = localStorage.getItem(\"user\");\n  let data_email = localStorage.getItem(\"email\");\n  let data_phone = localStorage.getItem(\"phone\");\n  axios.defaults.headers.common[\"Authorization\"] = \"\"; //axios.get(\"/profiles/\"+user_id).then(res => { data_email= res.data.email; data_phone =  res.data.phone_num; console.log(data_email, data_phone) }).catch(err => console.error(err));\n\n  const classes = useStyles();\n  const [tab, setTab] = React.useState(0);\n  const [password, setPassword] = React.useState({\n    newPassword: '',\n    confirmPassword: '',\n    currentPassword: ''\n  });\n  const [data, setData] = React.useState(null);\n  const [editable, setEditable] = React.useState(false);\n  let {\n    id\n  } = useParams();\n  const fileInput = React.useRef(null);\n\n  const handleChangeTab = (event, newValue) => {\n    setTab(newValue);\n  };\n\n  const location = useLocation();\n  const managementDispatch = useManagementDispatch();\n  const managementValue = useManagementState();\n\n  function extractExtensionFrom(filename) {\n    if (!filename) {\n      return null;\n    }\n\n    const regex = /(?:\\.([^.]+))?$/;\n    return regex.exec(filename)[1];\n  }\n\n  const uploadToServer = async (file, path, filename) => {\n    const formData = new FormData();\n    formData.append('file', file);\n    formData.append('filename', filename);\n    const uri = `${config.baseURLApi}/file/upload/${path}`;\n    await Axios.post(uri, formData, {\n      headers: {\n        'Content-Type': 'multipart/form-data'\n      }\n    });\n    const privateUrl = `${path}/${filename}`;\n    return `${config.baseURLApi}/file/download?privateUrl=${privateUrl}`;\n  };\n\n  const handleFile = async event => {\n    const file = event.target.files[0];\n    const extension = extractExtensionFrom(file.name);\n    const id = uuid();\n    const filename = `${id}.${extension}`;\n    const privateUrl = `users/avatar/${filename}`;\n    const publicUrl = await uploadToServer(file, 'users/avatar', filename);\n    let avatarObj = {\n      id: id,\n      name: file.name,\n      sizeInBytes: file.size,\n      privateUrl,\n      publicUrl,\n      new: true\n    };\n    setData({ ...data,\n      avatar: [...data.avatar, avatarObj]\n    });\n    return null;\n  };\n\n  const history = useHistory();\n\n  function sendNotification() {\n    const componentProps = {\n      type: \"feedback\",\n      message: \"User edited!\",\n      variant: \"contained\",\n      color: \"success\"\n    };\n    const options = {\n      type: \"info\",\n      position: toast.POSITION.TOP_RIGHT,\n      progressClassName: classes.progress,\n      className: classes.notification,\n      timeOut: 1000\n    };\n    return toast( /*#__PURE__*/React.createElement(Notification, Object.assign({}, componentProps, {\n      className: classes.notificationComponent,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 139,\n        columnNumber: 9\n      }\n    })), options);\n  }\n\n  useEffect(() => {\n    if (id !== 'edit') {\n      actions.doFind(id)(managementDispatch);\n    } else {\n      actions.doFind(sessionStorage.getItem('user_id'))(managementDispatch);\n    }\n  }, []);\n  useEffect(() => {\n    if (location.pathname.includes('edit')) {\n      setEditable(true);\n    }\n  }, [location.pathname]);\n  useEffect(() => {\n    setData(managementValue.currentUser);\n  }, [managementDispatch, managementValue, id]);\n\n  const deleteOneImage = id => {\n    setData({ ...data,\n      avatar: data.avatar.filter(avatar => avatar.id !== id)\n    });\n  };\n\n  function handleSubmit() {\n    if (id === 'edit') {\n      actions.doUpdate(sessionStorage.getItem('user_id'), data, history)(managementDispatch);\n    } else {\n      actions.doUpdate(id, data, history)(managementDispatch);\n    }\n\n    sendNotification();\n  }\n\n  function handleSubmit2() {\n    const user_id = localStorage.getItem(\"user\");\n    console.log(data.email, data.phone, \"test\");\n    axios.patch(\"/profiles/\" + user_id, {\n      email: data.email,\n      pnone_num: data.phone\n    }).then(res => {\n      console.log(res.data);\n    }).catch(err => console.error(err));\n  }\n\n  function handleUpdatePassword() {\n    actions.doChangePassword(password)(managementDispatch);\n  }\n\n  function handleChangePassword(e) {\n    setPassword({ ...password,\n      [e.target.name]: e.target.value\n    });\n  }\n\n  function handleChange(e) {\n    setData({ ...data,\n      [e.target.name]: e.target.value\n    });\n  }\n\n  return /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    spacing: 3,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Widget, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Box, {\n    display: 'flex',\n    justifyContent: 'center',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 212,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(Tabs, {\n    indicatorColor: \"primary\",\n    textColor: \"primary\",\n    value: tab,\n    onChange: handleChangeTab,\n    \"aria-label\": \"full width tabs example\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 213,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(Tab, {\n    label: \"\\u041F\\u0440\\u043E\\u0444\\u0438\\u043B\\u044C\",\n    icon: /*#__PURE__*/React.createElement(PersonOutlineIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 222,\n        columnNumber: 39\n      }\n    }),\n    classes: {\n      wrapper: classes.icon\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 220,\n      columnNumber: 29\n    }\n  }), /*#__PURE__*/React.createElement(Tab, {\n    label: \"\\u0421\\u043C\\u0435\\u043D\\u0438\\u0442\\u044C \\u043F\\u0430\\u0440\\u043E\\u043B\\u044C\",\n    icon: /*#__PURE__*/React.createElement(LockIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 227,\n        columnNumber: 39\n      }\n    }),\n    classes: {\n      wrapper: classes.icon\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 225,\n      columnNumber: 29\n    }\n  }), /*#__PURE__*/React.createElement(Tab, {\n    label: \"\\u041D\\u0430\\u0441\\u0442\\u0440\\u043E\\u0439\\u043A\\u0438\",\n    icon: /*#__PURE__*/React.createElement(SettingsIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 232,\n        columnNumber: 39\n      }\n    }),\n    classes: {\n      wrapper: classes.icon\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 230,\n      columnNumber: 29\n    }\n  }))))), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 239,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Widget, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 240,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    justify: 'center',\n    container: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 241,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(Box, {\n    display: 'flex',\n    flexDirection: 'column',\n    width: 600,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 242,\n      columnNumber: 25\n    }\n  }, tab === 0 ? /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Typography, {\n    variant: 'h5',\n    weight: 'medium',\n    style: {\n      marginBottom: 35\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 249,\n      columnNumber: 37\n    }\n  }, \"\\u041B\\u0438\\u0447\\u043D\\u044B\\u0435 \\u0434\\u0430\\u043D\\u043D\\u044B\\u0435\"), /*#__PURE__*/React.createElement(Typography, {\n    weight: 'medium',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 256,\n      columnNumber: 37\n    }\n  }, \"\\u0410\\u0432\\u0430\\u0442\\u0430\\u0440:\"), /*#__PURE__*/React.createElement(\"div\", {\n    class: classes.galleryWrap,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 259,\n      columnNumber: 37\n    }\n  }, data && data.avatar && data.avatar.length !== 0 ? data.avatar.map((avatar, idx) => /*#__PURE__*/React.createElement(\"div\", {\n    className: classes.imgWrap,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 262,\n      columnNumber: 41\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    className: classes.deleteImageX,\n    onClick: () => deleteOneImage(avatar.id),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 263,\n      columnNumber: 43\n    }\n  }, \"\\xD7\"), /*#__PURE__*/React.createElement(\"img\", {\n    src: avatar.publicUrl,\n    alt: \"photo\",\n    height: '100%',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 264,\n      columnNumber: 43\n    }\n  }))) : null), /*#__PURE__*/React.createElement(\"label\", {\n    className: classes.uploadLabel,\n    style: {\n      cursor: 'pointer'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 273,\n      columnNumber: 37\n    }\n  }, 'Загрузить фото', /*#__PURE__*/React.createElement(\"input\", {\n    style: {\n      display: 'none'\n    },\n    accept: \"image/*\",\n    type: \"file\",\n    ref: fileInput,\n    onChange: handleFile,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 278,\n      columnNumber: 41\n    }\n  })), /*#__PURE__*/React.createElement(Typography, {\n    size: 'sm',\n    style: {\n      marginBottom: 35\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 281,\n      columnNumber: 37\n    }\n  }, \".PNG, .JPG, .JPEG\"), /*#__PURE__*/React.createElement(TextField, {\n    id: \"outlined-basic\",\n    variant: \"outlined\",\n    style: {\n      marginBottom: 35\n    },\n    defaultValue: data_phone,\n    value: data && data.phone,\n    name: \"phone\",\n    onChange: handleChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 287,\n      columnNumber: 37\n    }\n  }), /*#__PURE__*/React.createElement(TextField, {\n    id: \"outlined-basic\",\n    variant: \"outlined\",\n    style: {\n      marginBottom: 35\n    },\n    type: 'email',\n    defaultValue: data_email,\n    value: data && data.email,\n    name: \"email\",\n    onChange: handleChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 296,\n      columnNumber: 37\n    }\n  })) : tab === 1 ? /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Typography, {\n    variant: 'h5',\n    weight: 'medium',\n    style: {\n      marginBottom: 35\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 309,\n      columnNumber: 37\n    }\n  }, \"\\u041F\\u0430\\u0440\\u043E\\u043B\\u044C\"), /*#__PURE__*/React.createElement(TextField, {\n    id: \"outlined-basic\",\n    variant: \"outlined\",\n    style: {\n      marginBottom: 35\n    },\n    defaultValue: 'Current Password',\n    value: password.currentPassword || '',\n    name: \"currentPassword\",\n    onChange: handleChangePassword,\n    helperText: 'Забыли пароль?',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 316,\n      columnNumber: 37\n    }\n  }), /*#__PURE__*/React.createElement(TextField, {\n    id: \"outlined-basic\",\n    variant: \"outlined\",\n    style: {\n      marginBottom: 35\n    },\n    defaultValue: 'New Password',\n    value: password.newPassword || '',\n    name: \"newPassword\",\n    onChange: handleChangePassword,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 326,\n      columnNumber: 37\n    }\n  }), /*#__PURE__*/React.createElement(TextField, {\n    id: \"outlined-basic\",\n    variant: \"outlined\",\n    style: {\n      marginBottom: 35\n    },\n    defaultValue: 'Verify Password',\n    value: password.confirmPassword || '',\n    name: \"confirmPassword\",\n    onChange: handleChangePassword,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 335,\n      columnNumber: 37\n    }\n  })) : /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Typography, {\n    variant: 'h5',\n    weight: 'medium',\n    style: {\n      marginBottom: 35\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 347,\n      columnNumber: 37\n    }\n  }, \"\\u041D\\u0430\\u0441\\u0442\\u0440\\u043E\\u0439\\u043A\\u0438\"), /*#__PURE__*/React.createElement(FormControl, {\n    variant: \"outlined\",\n    style: {\n      marginBottom: 35\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 354,\n      columnNumber: 37\n    }\n  }, /*#__PURE__*/React.createElement(Select, {\n    labelId: \"demo-simple-select-outlined-label\",\n    id: \"demo-simple-select-outlined\",\n    value: 10,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 358,\n      columnNumber: 41\n    }\n  }, /*#__PURE__*/React.createElement(MenuItem, {\n    value: 10,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 363,\n      columnNumber: 45\n    }\n  }, \"\\u042F\\u0437\\u044B\\u043A - \\u0420\\u0443\\u0441\\u0441\\u043A\\u0438\\u0439\"), /*#__PURE__*/React.createElement(MenuItem, {\n    value: 20,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 366,\n      columnNumber: 45\n    }\n  }), /*#__PURE__*/React.createElement(MenuItem, {\n    value: 30,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 368,\n      columnNumber: 45\n    }\n  }))), /*#__PURE__*/React.createElement(Box, {\n    display: \"flex\",\n    mt: 2,\n    alignItems: \"center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 372,\n      columnNumber: 37\n    }\n  }, /*#__PURE__*/React.createElement(Typography, {\n    weight: \"medium\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 373,\n      columnNumber: 41\n    }\n  }, \"\\u0423\\u0432\\u0435\\u0434\\u043E\\u043C\\u043B\\u0435\\u043D\\u0438\\u044F \\u043F\\u043E email\"), /*#__PURE__*/React.createElement(Switch, {\n    color: \"primary\",\n    checked: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 376,\n      columnNumber: 41\n    }\n  }))), /*#__PURE__*/React.createElement(Box, {\n    display: 'flex',\n    justifyContent: 'space-between',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 380,\n      columnNumber: 31\n    }\n  }, /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Button, {\n    variant: 'outlined',\n    color: 'primary',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 385,\n      columnNumber: 35\n    }\n  }, \"\\u0421\\u0431\\u0440\\u043E\\u0441\\u0438\\u0442\\u044C\"), /*#__PURE__*/React.createElement(Button, {\n    variant: 'contained',\n    color: 'success',\n    onClick: handleSubmit2,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 388,\n      columnNumber: 35\n    }\n  }, \"\\u0421\\u043E\\u0445\\u0440\\u0430\\u043D\\u0438\\u0442\\u044C\"))))))));\n};\n\nexport default Profile;","map":{"version":3,"sources":["/home/dekor/eqvium/react_material_test/admin-full/src/pages/profile/Profile.js"],"names":["React","useEffect","Grid","Box","TextField","Tabs","Tab","useParams","Checkbox","Switch","useLocation","useHistory","useStyles","PersonOutline","PersonOutlineIcon","Lock","LockIcon","Settings","SettingsIcon","uuid","Widget","Typography","Button","Select","MenuItem","FormControlLabel","FormControl","toast","Notification","useManagementDispatch","useManagementState","config","Axios","axios","actions","Profile","data_email","localStorage","getItem","data_phone","defaults","headers","common","classes","tab","setTab","useState","password","setPassword","newPassword","confirmPassword","currentPassword","data","setData","editable","setEditable","id","fileInput","useRef","handleChangeTab","event","newValue","location","managementDispatch","managementValue","extractExtensionFrom","filename","regex","exec","uploadToServer","file","path","formData","FormData","append","uri","baseURLApi","post","privateUrl","handleFile","target","files","extension","name","publicUrl","avatarObj","sizeInBytes","size","new","avatar","history","sendNotification","componentProps","type","message","variant","color","options","position","POSITION","TOP_RIGHT","progressClassName","progress","className","notification","timeOut","notificationComponent","doFind","sessionStorage","pathname","includes","currentUser","deleteOneImage","filter","handleSubmit","doUpdate","handleSubmit2","user_id","console","log","email","phone","patch","pnone_num","then","res","catch","err","error","handleUpdatePassword","doChangePassword","handleChangePassword","e","value","handleChange","wrapper","icon","marginBottom","galleryWrap","length","map","idx","imgWrap","deleteImageX","uploadLabel","cursor","display"],"mappings":"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","sourcesContent":["import React, { useEffect } from 'react'\nimport { Grid, Box, TextField } from '@material-ui/core'\nimport Tabs from '@material-ui/core/Tabs'\nimport Tab from '@material-ui/core/Tab'\nimport { useParams } from 'react-router'\nimport Checkbox from '@material-ui/core/Checkbox'\nimport Switch from '@material-ui/core/Switch'\nimport { useLocation, useHistory } from 'react-router-dom';\nimport useStyles from './styles'\n\nimport {\n    PersonOutline as PersonOutlineIcon,\n    Lock as LockIcon,\n    Settings as SettingsIcon,\n} from '@material-ui/icons'\nimport uuid from 'uuid/v4'\n\nimport Widget from '../../components/Widget'\nimport { Typography, Button } from '../../components/Wrappers'\nimport Select from '@material-ui/core/Select'\nimport MenuItem from '@material-ui/core/MenuItem'\nimport FormControlLabel from '@material-ui/core/FormControlLabel'\nimport FormControl from '@material-ui/core/FormControl'\nimport { toast } from 'react-toastify'\n\nimport Notification from '../../components/Notification'\nimport {\n  useManagementDispatch,\n  useManagementState,\n} from '../../context/ManagementContext'\nimport config from '../../config'\nimport Axios from 'axios'\nimport axios from 'axios'\n\nimport { actions } from '../../context/ManagementContext'\n\nconst Profile = () => {\n    \n\n//     const user_id = localStorage.getItem(\"user\");\n     let data_email = localStorage.getItem(\"email\");\n     let data_phone = localStorage.getItem(\"phone\");\n     axios.defaults.headers.common[\"Authorization\"] = \"\";\n   \n     //axios.get(\"/profiles/\"+user_id).then(res => { data_email= res.data.email; data_phone =  res.data.phone_num; console.log(data_email, data_phone) }).catch(err => console.error(err));\n    \n\n\n    const classes = useStyles()\n    const [tab, setTab] = React.useState(0)\n    const [password, setPassword] = React.useState({\n      newPassword: '',\n      confirmPassword: '',\n      currentPassword: '',\n    });\n    const [data, setData] = React.useState(null)\n    const [editable, setEditable] = React.useState(false)\n    let { id } = useParams();\n    const fileInput = React.useRef(null);\n    const handleChangeTab = (event, newValue) => {\n        setTab(newValue)\n    }\n    const location = useLocation();\n    const managementDispatch = useManagementDispatch()\n    const managementValue = useManagementState()\n\n    function extractExtensionFrom(filename) {\n      if (!filename) {\n        return null;\n      }\n    \n      const regex = /(?:\\.([^.]+))?$/;\n      return regex.exec(filename)[1];\n    }\n\n    const uploadToServer = async (file, path, filename) => {\n      const formData = new FormData();\n      formData.append('file', file);\n      formData.append('filename', filename);\n      const uri = `${config.baseURLApi}/file/upload/${path}`;\n      await Axios.post(uri, formData,\n        {\n          headers: {\n            'Content-Type': 'multipart/form-data',\n          },\n        },\n      );\n  \n      const privateUrl = `${path}/${filename}`;\n  \n      return `${config.baseURLApi}/file/download?privateUrl=${privateUrl}`;\n    }\n\n    const handleFile = async (event) => {\n      const file = event.target.files[0];\n  \n      const extension = extractExtensionFrom(file.name);\n      const id = uuid();\n      const filename = `${id}.${extension}`;\n      const privateUrl = `users/avatar/${filename}`;\n  \n      const publicUrl = await uploadToServer(\n        file,\n        'users/avatar',\n        filename,\n      );\n      let avatarObj = {\n        id: id,\n        name: file.name,\n        sizeInBytes: file.size,\n        privateUrl,\n        publicUrl,\n        new: true\n      }\n\n      setData({\n        ...data,\n        avatar: [...data.avatar, avatarObj]\n      })\n\n      return null;\n    }\n    const history = useHistory();\n    function sendNotification() {\n      const componentProps = {\n        type: \"feedback\",\n        message: \"User edited!\",\n        variant: \"contained\",\n        color: \"success\"\n      };\n      const options = {\n        type: \"info\",\n        position: toast.POSITION.TOP_RIGHT,\n        progressClassName: classes.progress,\n        className: classes.notification,\n        timeOut: 1000\n      };\n      return toast(\n        <Notification\n          {...componentProps}\n          className={classes.notificationComponent}\n        />,\n        options\n      );\n    }\n    useEffect(() => {\n      if (id !== 'edit') {\n        actions.doFind(id)(managementDispatch)\n      } else {\n        actions.doFind(sessionStorage.getItem('user_id'))(managementDispatch)\n      }\n    }, []);\n\n    useEffect(() => {\n      \n      if (location.pathname.includes('edit')) {\n        setEditable(true);\n      }\n    }, [location.pathname]);\n\n\n    useEffect(() => {\n        setData(managementValue.currentUser)\n    }, [managementDispatch, managementValue, id])\n\n    const deleteOneImage = (id) => {\n      setData({\n        ...data,\n        avatar: data.avatar.filter(avatar => avatar.id !== id)\n      })\n    }\n\n    function handleSubmit() {\n      if (id === 'edit') {\n        actions.doUpdate(sessionStorage.getItem('user_id'), data, history)(managementDispatch)\n      } else {\n        actions.doUpdate(id, data, history)(managementDispatch)        \n      }\n      sendNotification()\n    }\n\n\n    function handleSubmit2() {\n      const user_id = localStorage.getItem(\"user\");\n      console.log(data.email, data.phone, \"test\");\n      axios.patch(\"/profiles/\"+user_id, {email:data.email, pnone_num:data.phone}).then(res => { console.log(res.data) }).catch(err => console.error(err));\n    }\n\n\n    function handleUpdatePassword() {\n      actions.doChangePassword(password)(managementDispatch)\n    }\n\n    function handleChangePassword(e) {\n      setPassword({\n        ...password,\n        [e.target.name]: e.target.value,\n      })\n    }\n\n    function handleChange(e) {\n      setData({\n        ...data,\n        [e.target.name]: e.target.value,\n      });\n    }\n\n    return (\n        <Grid container spacing={3}>\n            <Grid item xs={12}>\n                <Widget>\n                    <Box display={'flex'} justifyContent={'center'}>\n                        <Tabs\n                            indicatorColor=\"primary\"\n                            textColor=\"primary\"\n                            value={tab}\n                            onChange={handleChangeTab}\n                            aria-label=\"full width tabs example\"\n                        >\n                            <Tab\n                                label=\"Профиль\"\n                                icon={<PersonOutlineIcon />}\n                                classes={{ wrapper: classes.icon }}\n                            />\n                            <Tab\n                                label=\"Сменить пароль\"\n                                icon={<LockIcon />}\n                                classes={{ wrapper: classes.icon }}\n                            />\n                            <Tab\n                                label=\"Настройки\"\n                                icon={<SettingsIcon />}\n                                classes={{ wrapper: classes.icon }}\n                            />\n                        </Tabs>\n                    </Box>\n                </Widget>\n            </Grid>\n            <Grid item xs={12}>\n                <Widget>\n                    <Grid item justify={'center'} container>\n                        <Box\n                            display={'flex'}\n                            flexDirection={'column'}\n                            width={600}\n                        >\n                            { tab === 0 ? (\n                                <>\n                                    <Typography\n                                        variant={'h5'}\n                                        weight={'medium'}\n                                        style={{ marginBottom: 35 }}\n                                    >\n                                        Личные данные\n                                    </Typography>\n                                    <Typography weight={'medium'}>\n                                        Аватар:\n                                    </Typography>\n                                    <div class={classes.galleryWrap}>\n                                    {data && data.avatar && data.avatar.length !== 0 ? (\n                                      data.avatar.map((avatar, idx) => (\n                                        <div className={classes.imgWrap}>\n                                          <span className={classes.deleteImageX} onClick={() => deleteOneImage(avatar.id)}>×</span>\n                                          <img\n                                              src={avatar.publicUrl}\n                                              alt=\"photo\"\n                                              height={'100%'}\n                                          />                                          \n                                        </div>\n                                      ))\n                                    ): null}\n                                    </div>\n                                    <label\n                                      className={classes.uploadLabel}\n                                      style={{ cursor: 'pointer' }}\n                                    >\n                                      {'Загрузить фото'}\n                                        <input style={{ display: 'none' }} accept=\"image/*\" type=\"file\" ref={fileInput} onChange={handleFile} />\n                                    </label>\n\n                                    <Typography\n                                        size={'sm'}\n                                        style={{ marginBottom: 35 }}\n                                    >\n                                        .PNG, .JPG, .JPEG\n                                    </Typography>\n                                    <TextField\n                                        id=\"outlined-basic\"\n                                        variant=\"outlined\"\n                                        style={{ marginBottom: 35 }}\n                                        defaultValue={data_phone}\n                                        value={data && data.phone}\n                                        name=\"phone\"\n                                        onChange={handleChange}\n                                    />\n                                    <TextField\n                                        id=\"outlined-basic\"\n                                        variant=\"outlined\"\n                                        style={{ marginBottom: 35 }}\n                                        type={'email'}\n                                        defaultValue={data_email}\n                                        value={data && data.email}\n                                        name=\"email\"\n                                        onChange={handleChange}\n                                    />\n                                </>\n                            ) : tab === 1 ? (\n                                <>\n                                    <Typography\n                                        variant={'h5'}\n                                        weight={'medium'}\n                                        style={{ marginBottom: 35 }}\n                                    >\n                                        Пароль\n                                    </Typography>\n                                    <TextField\n                                        id=\"outlined-basic\"\n                                        variant=\"outlined\"\n                                        style={{ marginBottom: 35 }}\n                                        defaultValue={'Current Password'}\n                                        value={password.currentPassword || ''}\n                                        name=\"currentPassword\"\n                                        onChange={handleChangePassword}\n                                        helperText={'Забыли пароль?'}\n                                    />\n                                    <TextField\n                                        id=\"outlined-basic\"\n                                        variant=\"outlined\"\n                                        style={{ marginBottom: 35 }}\n                                        defaultValue={'New Password'}\n                                        value={password.newPassword || ''}\n                                        name=\"newPassword\"\n                                        onChange={handleChangePassword}\n                                    />\n                                    <TextField\n                                        id=\"outlined-basic\"\n                                        variant=\"outlined\"\n                                        style={{ marginBottom: 35 }}\n                                        defaultValue={'Verify Password'}\n                                        value={password.confirmPassword || ''}\n                                        name=\"confirmPassword\"\n                                        onChange={handleChangePassword}\n                                    />\n                                </>\n                            ) : (\n                                <>\n                                    <Typography\n                                        variant={'h5'}\n                                        weight={'medium'}\n                                        style={{ marginBottom: 35 }}\n                                    >\n                                        Настройки\n                                    </Typography>\n                                    <FormControl\n                                        variant=\"outlined\"\n                                        style={{ marginBottom: 35 }}\n                                    >\n                                        <Select\n                                            labelId=\"demo-simple-select-outlined-label\"\n                                            id=\"demo-simple-select-outlined\"\n                                            value={10}\n                                        >\n                                            <MenuItem value={10}>\n                                                Язык - Русский\n                                            </MenuItem>\n                                            <MenuItem value={20}>\n                                            </MenuItem>\n                                            <MenuItem value={30}>\n                                            </MenuItem>\n                                        </Select>\n                                    </FormControl>\n                                    <Box display={\"flex\"} mt={2} alignItems={\"center\"}>\n                                        <Typography weight={\"medium\"}>\n                                            Уведомления по email\n                                        </Typography>\n                                        <Switch color={\"primary\"} checked />\n                                    </Box>\n                                </>\n                            )}\n                              <Box\n                                  display={'flex'}\n                                  justifyContent={'space-between'}\n                              >\n                                  <>\n                                  <Button variant={'outlined'} color={'primary'}>\n                                      Сбросить\n                                  </Button>\n                                  <Button variant={'contained'} color={'success'} onClick={handleSubmit2}>\n                                      Сохранить\n                                  </Button>\n                                  </>                                \n\n                              </Box>                              \n                             \n                        </Box>\n                    </Grid>\n                </Widget>\n            </Grid>\n        </Grid>\n    )\n}\n\nexport default Profile\n"]},"metadata":{},"sourceType":"module"}